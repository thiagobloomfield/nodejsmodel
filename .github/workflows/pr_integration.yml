name: PR Integration

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  # sonarcloud:
  #   name: SonarCloud
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #       with:
  #         fetch-depth: 0 
  #     - name: Install dependencies
  #       run: npm install
  #     - name: Test and coverage
  #       run: npm run test-coverage
  #     - name: SonarCloud Scan
  #       uses: SonarSource/sonarcloud-github-action@master
  #       env:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #         SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

  # deploy:
  #   name: deploy
  #   needs: sonarcloud
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: akhileshns/heroku-deploy@v3.12.13
  #       with:
  #         heroku_api_key: ${{secrets.HEROKU_API_KEY}}
  #         heroku_app_name: "nodejsmodel"
  #         heroku_email: "thiagobloomf@gmail.com"

  e2e:
    # needs: deploy
    runs-on: ubuntu-latest
    steps:
      - uses: cypress-io/github-action@v5
      - name: Cypress run
        uses: cypress-io/github-action@v5
        with:
          build: npm install
          start: npm run e2e